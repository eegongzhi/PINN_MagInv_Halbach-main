# PINN_MagInv_Halbach
This project addresses the inverse magnetization problem of a simple circular Halbach array.

This is an application (extension) of the PINN framework proposed in [this paper](http://dx.doi.org/10.1049/elp2.70047). The PINN framework is almost unchanged, but with a different application scenario.

## Problem setup
The problem setup is briefly summarized below.

![image](/IMG/setup.PNG)

Consider a circular Halbach array. The array is in the shape of a hollow tube, and we study only a cross-section. The tube consists of multiple magnets that are magnetized in either + $\rho$ or - $\rho$ direction. We measure the magnetic field along a circle (in a dashed line). 

It should be noted that the magnetization in realistic Halbach arrays is usually much more complicated than this case. However, we consider this _simple_ case only for easier results evaluation; the codes (inverse part) can still be used for those complicated cases, provided the observation data are given.

## Heads-ups
Based on the paper indicated above, we design the PINN framework below.

![image](/IMG/framework.PNG)

**Note**:
- This is a 2D problem in cylindrical coordinates. Therefore, we only consider the $\rho$ and the $\varphi$ components.
- The project is built on [DeepXDE](https://github.com/lululxvi/deepxde). 
- We use the ResNet with short-cuts, instead of a simple fully-connected network. The ResNet is NOT included in DeepXDE, so we have to write our own codes for it.
- As an illustration, we consider a case with 10 pairs of poles. Note that some tricky techniques in arranging the data need to be considered carefully if the magnetization is more complicated. Bad data arrangement will lead to unsatisfactory training results.

## Project structure
The project consists of two parts, responsible for the observation data generation and the inverse problem, respectively.

**data_generation**: First, we generate the observation data by running "main.m". We can edit the ground-truth of the magnetization in the program, and the generated file "H_real.m" contains the observed (measured) magnetic field along the observation circle.

**inverse_part**: Next, we manually copy "H_real.m", which is generated above, to this folder, and run "magnetInverseParallel_modified.py". The predicted magnetization profile is stored in "predicted_M.txt".

## Results
For conciseness, we do not include the result files in the repository. We show the (local) results below.

![image](/IMG/results.PNG)

It is clear that the predicted magnetization is very close to the ground truth, and the magnetic field generated by the predicted magnetization is also close to the measured one.





